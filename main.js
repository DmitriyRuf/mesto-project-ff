!function(){"use strict";function e(e,n,r,o,c,i){var a=e.querySelector(".places__item").cloneNode(!0),u=a.querySelector(".card__image"),s=a.querySelector(".card__title"),l=a.querySelector(".card__like-button"),p=(a.querySelector(".card__like-count"),a.querySelector(".card__delete-button"));return a.id=n._id,u.src=n.link,u.alt=n.name,s.textContent=n.name,t(n,r,a),n.owner._id==r._id?p.addEventListener("click",(function(){return o(n,a)})):p.remove(),u.addEventListener("click",(function(){return c(n)})),l.addEventListener("click",(function(){return i(n,r,a)})),a}function t(e,t,n){var r=n.querySelector(".card__like-button");n.querySelector(".card__like-count").textContent=e.likes.length,e.likes.filter((function(e){return e._id===t._id})).length>0?r.classList.add("card__like-button_is-active"):r.classList.remove("card__like-button_is-active")}function n(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");null!==t&&c(t)}}function r(e){e.target.classList.contains("popup_is-opened")&&c(e.target)}function o(e){e.classList.add("popup_is-opened"),document.body.addEventListener("keydown",n),e.addEventListener("click",r)}function c(e){e.classList.remove("popup_is-opened"),document.body.removeEventListener("keydown",n),e.removeEventListener("click",r)}var i={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",errorApiClass:".query-api-error",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function a(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function u(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}function s(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}(t,n):u(t,n)}function l(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector),o=e.querySelector(t.errorApiClass);n.forEach((function(n){a(e,n,t)})),u(r,t),o.classList.remove(t.errorClass),o.textContent=""}var p,d,f,_,m,y={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-31",headers:{authorization:"8fb61c75-604e-4d96-aba9-a3e69ed9080c","Content-Type":"application/json"}},v=document.querySelector("#card-template").content,h=document.querySelector(".page__content"),S=h.querySelector(".content"),q=S.querySelector(".places").querySelector(".places__list"),b=S.querySelector(".profile__info"),k=S.querySelector(".profile__image"),L=S.querySelector(".profile__edit-button"),C=S.querySelector(".profile__add-button"),E=S.querySelector(".profile__image-edit"),g=h.querySelector(".popup_type_edit"),j=h.querySelector(".popup_type_new-card"),P=h.querySelector(".popup_type_edit-avatar"),x=h.querySelector(".popup_type_image"),A=h.querySelector(".popup_type_delete_confirm"),U=g.querySelector(".popup__form"),T=j.querySelector(".popup__form"),B=P.querySelector(".popup__form"),D=A.querySelector(".popup__form"),w=j.querySelector(".popup__close"),N=g.querySelector(".popup__close"),O=x.querySelector(".popup__close"),I=P.querySelector(".popup__close"),J=A.querySelector(".popup__close");function M(e){var t=e.querySelector(i.errorApiClass);t.classList.remove(i.errorClass),t.textContent=""}function H(e,t){var n=e.querySelector(i.errorApiClass);n.classList.add(i.errorClass),n.textContent=t}function V(e){e.querySelector(".popup__button").textContent="Сохранить"}function z(e){e.querySelector(".popup__button").textContent="Сохранение..."}function $(e){e.querySelector(".popup__button").textContent="Да"}function F(e,t){if(t.classList.contains("profile__info")){var n=t.querySelector(".profile__title"),r=t.querySelector(".profile__description");n.textContent=e.name,r.textContent=e.about,k.style.backgroundImage="url('"+e.avatar+"')",f=e}}function G(e){!function(e){var t=x.querySelector(".popup__image"),n=x.querySelector(".popup__caption");t.src=e.link,t.alt=e.name,n.textContent=e.name}(e),o(x)}function K(e,t){d=e,p=t,$(D),M(D),o(A)}function Q(e){c(e.target.closest(".popup"))}function R(e,n,r){var o;r.querySelector(".card__like-button").classList.contains("card__like-button_is-active")?(o=e._id,fetch("".concat(y.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось убрать лайк. Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return Promise.reject(e)}))).then((function(e){t(e,n,r)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(y.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось поставить лайк. Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return Promise.reject(e)}))}(e._id).then((function(e){t(e,n,r)})).catch((function(e){console.log(e)}))}function W(t){t.preventDefault(),M(T),z(T);var n,r=T.querySelector(".popup__input_type_card-name"),o=T.querySelector(".popup__input_type_url");(n={name:r.value,link:o.value},fetch("".concat(y.baseUrl,"/cards"),{method:"POST",headers:y.headers,body:JSON.stringify({name:n.name,link:n.link})}).then((function(e){return e.ok?e.json():Promise.reject("Добавление карточки не выполнено. Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return Promise.reject(e)}))).then((function(t){var n=e(v,t,f,K,G,R);q.prepend(n),T.reset(),l(T,i),c(j)})).catch((function(e){H(T,e),V(T)}))}L.addEventListener("click",(function(e){V(U),l(U,i),function(e,t){if(e.classList.contains("profile__info")&&t.classList.contains("popup_type_edit")){var n=e.querySelector(".profile__title"),r=e.querySelector(".profile__description"),o=t.querySelector(".popup__form");o.elements.name.value=n.textContent,o.elements.description.value=r.textContent}}(b,g),o(g)})),C.addEventListener("click",(function(e){T.reset(),V(T),l(T,i),o(j)})),E.addEventListener("click",(function(e){var t,n;V(B),l(B,i),n=P,(t=k).classList.contains("profile__image")&&n.classList.contains("popup_type_edit-avatar")&&(n.querySelector(".popup__form").elements.link.value=t.style.backgroundImage.replace(/^.+?['"]|['"].+?$/g,"")),o(P)})),N.addEventListener("click",Q),I.addEventListener("click",Q),w.addEventListener("click",Q),O.addEventListener("click",Q),J.addEventListener("click",Q),U.addEventListener("submit",(function(e){var t,n;e.preventDefault(),M(U),z(U),(t=U.elements.name.value,n=U.elements.description.value,fetch("".concat(y.baseUrl,"/users/me"),{method:"PATCH",headers:y.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Изменение профиля не выполнено. Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return Promise.reject(e)}))).then((function(e){F(e,b),U.reset(),c(g)})).catch((function(e){H(U,e),V(U)}))})),B.addEventListener("submit",(function(e){var t;e.preventDefault(),M(B),z(B),(t=B.elements.link.value,fetch("".concat(y.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:y.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Изменение аватара не выполнено. Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return Promise.reject(e)}))).then((function(e){var t,n;t=e,(n=k).classList.contains("profile__image")&&(n.style.backgroundImage="url('"+t.avatar+"')",f=t),B.reset(),c(P)})).catch((function(e){H(B,e),V(B)}))})),T.addEventListener("submit",W),T.addEventListener("submit",W),D.addEventListener("submit",(function(e){var t;e.preventDefault(),M(D),D.querySelector(".popup__button").textContent="Удаление...",(t=d._id,fetch("".concat(y.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("Удаление карточки не выполнено. Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return Promise.reject(e)}))).then((function(e){console.log(e),p.remove(),p={},d={},c(A)})).catch((function(e){H(D,e),$(D)}))})),h.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated")})),_=i,(m=Array.from(document.querySelectorAll(_.formSelector))).forEach((function(e){m.forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector),o=e.querySelector(t.errorApiClass);s(n,r,t),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.patternMessage):t.setCustomValidity(""),t.validity.valid?a(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,c,t),s(n,r,t),o.classList.remove(t.errorClass),o.textContent=""}))}))}(e,_)}))}));var X=[fetch("".concat(y.baseUrl,"/users/me"),{headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("Запрос профайла не выполнен. Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){console.log(e)})),fetch("".concat(y.baseUrl,"/cards"),{headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("Запрос карточек не выполнен. Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){console.log(e)}))];Promise.all(X).then((function(t){F(t[0],b),t[1].forEach((function(t){var n=e(v,t,f,K,G,R);q.append(n)}))})).catch((function(e){console.log(e)}))}();